#!/usr/bin/python
import sys

# Import Atarashii -------------------------------------------------------------
sys.path.insert(0, "/usr/share/pyshared")
try:
    import atarashii
    
except:
    if sys.path[0] == "/usr/share/pyshared": 
        sys.path.pop(0)
        
    sys.exit(3)

# Check what we should start ----------------------------------------------------
arg = ""
if len(sys.argv) == 2:
    arg = sys.argv[1]

# Application
if arg == "main":
    atarashii.start()

# Crash Wrapper
else:
    if arg == "auto":
        import time
        time.sleep(3)
    
    # Wrap arround crazy random GDK and XOrg Erros ^.^"
    import subprocess
    error = 0
    while error == 0:
        print "Starting Atarashii..."
        error = subprocess.call(["atarashii", "main"])
        if error == 0:
            atarashii.crash()
            print "Atarashii crashed, restarting"
        
        elif error == 2:
            print "Atarashii is already running"
        
        elif error == 3:
            print "Importing Atarashii failed"
        
        exit(error)

